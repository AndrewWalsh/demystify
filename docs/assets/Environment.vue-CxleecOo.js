import{d as K,r as g,c as le,w as H,K as D,B as d,Y as j,F,S as U,U as E,z as w,u as r,a2 as N,Q as C,R as A,a0 as oe,bz as Ce,D as f,am as ke,C as h,aK as Q,ah as ae,$ as T,aj as ye,af as G,V as J,aL as te,az as ge,b4 as Ee,aI as we,bg as P,aG as $,o as _e,bl as Ie,L as $e,an as ze,at as Se,H as Ve,ae as je}from"./index-XT8p-Ppy.js";import{d as De}from"./LibraryIcon.vue-ibYip0im.js";import{C as Me}from"./EditSidebarListElement.vue-DnlWKQ1J.js";import{e as Be,m as Ne,g as We,a as Oe}from"./DeleteSidebarListElement.vue-BGOmXf3V.js";import{_ as Re,f as ee}from"./SidebarListElement.vue-B4C9MU5x.js";import{x as Ue,a as Fe}from"./ViewLayoutContent.vue-wBu05qAZ.js";import{h as Ke,b as Le}from"./CommandActionInput.vue-BUTul70t.js";const Pe=["onClick"],Ae=["placeholder"],ne=K({__name:"EnvironmentColors",props:{activeColor:{},selector:{type:Boolean,default:!1}},emits:["select"],setup(W,{emit:_}){const n=W,y=_,p=g(""),i=g(null),k=g(!1),b=g(!1),u=[{color:"#8E8E8E"},{color:"#EF0006"},{color:"#EDBE20"},{color:"#069061"},{color:"#FB892C"},{color:"#0082D0"},{color:"#5203D1"},{color:"#FFC0CB"}],I=le(()=>n.activeColor&&!u.some(a=>a.color===n.activeColor)||p.value?`background-color: ${n.activeColor||p.value};`:"background: linear-gradient(to right, rgb(235, 87, 87), rgb(242, 201, 76), rgb(76, 183, 130), rgb(78, 167, 252), rgb(250, 96, 122));"),z=()=>{k.value=!k.value,n.selector&&(b.value=!1),ke(()=>{i.value&&i.value.focus()})};H(p,a=>{a&&!a.startsWith("#")&&(p.value=`#${a}`),k.value=!0});const M=()=>{n.selector&&(b.value=!b.value)},S=a=>{y("select",a),n.selector&&(b.value=!1)};return(a,t)=>(d(),D("div",null,[k.value?j("",!0):(d(),D(F,{key:0},[n.selector&&!b.value?(d(),D("div",{key:0,class:E(["flex cursor-pointer items-center justify-center rounded-full",n.selector?"h-4 w-4":"h-5 w-5"]),style:U({backgroundColor:a.activeColor}),onClick:M},[a.activeColor?(d(),w(r(N),{key:0,class:E(["text-c-btn",n.selector&&"p-0.5"]),icon:"Checkmark",size:"xs"},null,8,["class"])):j("",!0)],6)):j("",!0),b.value||!n.selector?(d(),D("div",{key:1,class:E(["color-selector flex flex-row gap-1.5 items-center justify-between space-x-1",n.selector?"h-4":"min-h-10 min-w-[296px]"])},[(d(),D(F,null,A(u,m=>C("div",{key:m.color,class:E(["flex cursor-pointer items-center justify-center rounded-full",n.selector?"h-4 w-4":"h-5 w-5"]),style:U({backgroundColor:m.color}),onClick:c=>S(m.color)},[a.activeColor===m.color&&!p.value?(d(),w(r(N),{key:0,class:E(["text-c-btn",n.selector&&"p-0.5"]),icon:"Checkmark",size:"xs"},null,8,["class"])):j("",!0)],14,Pe)),64)),t[2]||(t[2]=C("hr",{class:"w-0.5 h-5 border-ghost border-l"},null,-1)),C("label",{class:E(["cursor-pointer flex flex-row justify-center gap-2 items-center rounded-full z-10",n.selector?"h-4 w-4":"h-5 w-5"]),style:U(I.value),onClick:z},[!k.value&&(a.activeColor===p.value||a.activeColor&&!u.some(m=>m.color===a.activeColor))?(d(),w(r(N),{key:0,class:"text-c-btn",icon:"Checkmark",size:"xs"})):j("",!0)],6)],2)):j("",!0)],64)),k.value?(d(),D("div",{key:1,class:E(["color-selector flex flex-1 gap-2 items-center rounded",n.selector?"h-4":"min-h-10"])},[C("span",{class:E(["absolute border border-dashed rounded-full",n.selector?"h-4 w-4":"h-5 w-5"])},null,2),C("span",{class:E(["rounded-full z-[1]",n.selector?"h-4 w-4":"h-5 w-5"]),style:U(I.value)},null,6),oe(C("input",{ref_key:"customColorInputRef",ref:i,"onUpdate:modelValue":t[0]||(t[0]=m=>p.value=m),class:"border-transparent flex-1 outline-none w-full text-sm",placeholder:a.activeColor||"#000000",type:"text",onInput:t[1]||(t[1]=m=>S(p.value))},null,40,Ae),[[Ce,p.value]]),C("button",{class:"text-c-3 hover:bg-b-2 p-1.5 rounded-lg",type:"button",onClick:z},[f(r(N),{icon:"Checkmark",size:"xs"})])],2)):j("",!0)]))}}),Te={class:"flex flex-col gap-4"},Ge=K({__name:"EnvironmentColorModal",props:{state:{},selectedColor:{}},emits:["cancel","submit"],setup(W,{emit:_}){const n=W,y=_,p=g(""),i=b=>{p.value=b},k=()=>{y("submit",p.value),p.value=""};return(b,u)=>(d(),w(r(Q),{size:"xxs",state:b.state,title:"Edit Environment Color"},{default:h(()=>[C("div",Te,[f(ne,{activeColor:p.value||n.selectedColor,class:"p-1 w-full",onSelect:i},null,8,["activeColor"]),f(Be,{onCancel:u[0]||(u[0]=I=>y("cancel")),onSubmit:k})])]),_:1},8,["state"]))}}),Je={class:"flex items-start gap-2"},He=K({__name:"EnvironmentModal",props:{state:{},activeWorkspaceCollections:{},collectionId:{}},emits:["cancel","submit"],setup(W,{emit:_}){const n=W,y=_,{events:p}=ae(),i=g(""),k=g("#8E8E8E"),b=le(()=>[...n.activeWorkspaceCollections.filter(a=>{var t;return((t=a.info)==null?void 0:t.title)!=="Drafts"}).map(a=>{var t;return{id:a.uid,label:((t=a.info)==null?void 0:t.title)??"Untitled Collection"}})]),u=g(b.value.find(a=>a.id===n.collectionId)),{toast:I}=te(),z=a=>{k.value=a};H(()=>n.state.open,a=>{a&&(i.value="",k.value="#8E8E8E",n.collectionId?u.value=b.value.find(t=>t.id===n.collectionId):u.value=void 0)});const M=()=>{var a,t,m,c;if(!((a=u.value)!=null&&a.id)){I("Please select a collection before adding an environment.","error");return}y("submit",{name:i.value,color:k.value,type:((t=u.value)==null?void 0:t.id)==="global"?"global":"collection",collectionId:((m=u.value)==null?void 0:m.id)!=="global"?(c=u.value)==null?void 0:c.id:void 0})},S=()=>{n.state.hide(),p.commandPalette.emit({commandName:"Create Collection"})};return(a,t)=>(d(),w(r(Q),{bodyClass:"border-t-0 rounded-t-lg",size:"xs",state:a.state},{default:h(()=>[f(Ke,{disabled:!u.value,onCancel:t[2]||(t[2]=m=>y("cancel")),onSubmit:M},{options:h(()=>[f(r(ye),{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=m=>u.value=m),options:b.value,placeholder:"Select Type"},{default:h(()=>[b.value.length>0?(d(),w(r(G),{key:0,class:"hover:bg-b-2 max-h-8 w-fit justify-between gap-1 p-2 text-xs",variant:"outlined"},{default:h(()=>[C("span",{class:E(u.value?"text-c-1":"text-c-3")},J(u.value?u.value.label:"Select Collection"),3),f(r(N),{class:"text-c-3",icon:"ChevronDown",size:"xs"})]),_:1})):(d(),w(r(G),{key:1,class:"hover:bg-b-2 max-h-8 justify-between gap-1 p-2 text-xs",variant:"outlined",onClick:S},{default:h(()=>t[3]||(t[3]=[C("span",{class:"text-c-1"},"Create Collection",-1)])),_:1}))]),_:1},8,["modelValue","options"])]),submit:h(()=>t[4]||(t[4]=[T(" Add Environment ")])),default:h(()=>[C("div",Je,[f(ne,{activeColor:k.value,class:"peer",selector:"",onSelect:z},null,8,["activeColor"]),f(Le,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=m=>i.value=m),class:"-mt-[.5px] !p-0 peer-has-[.color-selector]:hidden",placeholder:"Environment name"},null,8,["modelValue"])])]),_:1},8,["disabled"])]),_:1},8,["state"]))}}),Qe={class:"flex-1"},Ye=["onClick"],qe={class:"flex h-5 max-w-[14px] items-center justify-center"},nl=K({__name:"Environment",setup(W){const _=ge(),n=Ee(),{activeWorkspace:y,activeEnvironment:p,activeWorkspaceCollections:i,activeEnvVariables:k}=we(),{events:b,workspaceMutators:u,collectionMutators:I}=ae(),{collapsedSidebarFolders:z,toggleSidebarFolder:M}=Ie(),S=P(),a=P(),t=P(),m=g(null),c=g("default"),Y=g(""),O=g(void 0),V=g(void 0),R=g(void 0),{toast:q}=te(),se=l=>JSON.parse(l);function X(l,o,e){var s;l&&(o.uid===e?q(`Environment name already used in ${(s=o.info)==null?void 0:s.title}`,"error"):q("Environment name already used in another collection","error"))}function re(l){i.value.some(o=>{const e=Object.keys(o["x-scalar-environments"]||{}).includes(l.name);return X(e,o,l.collectionId),e})||(l.collectionId&&(I.addEnvironment(l.name,{variables:{},color:l.color},l.collectionId),z[l.collectionId]||M(l.collectionId),_.push({name:"environment.collection",params:{[$.Collection]:l.collectionId,[$.Environment]:l.name}})),a.hide())}function ie(l){var o,e;if(p){const s=se(l);if(c.value==="default")u.edit((o=y.value)==null?void 0:o.uid,"environments",s);else{const x=i.value.find(v=>{var B;return(B=v["x-scalar-environments"])==null?void 0:B[c.value??""]});if((e=x==null?void 0:x["x-scalar-environments"])!=null&&e[c.value??""]){const v=x["x-scalar-environments"][c.value??""];v&&(v.variables=s,I.edit(x.uid,"x-scalar-environments",x["x-scalar-environments"]))}}}}const L=l=>{O.value=l,a.show()},ce=(l,o)=>{V.value=l,O.value=o,R.value=l,t.show()},ue=l=>{var o,e,s;m.value=l,Y.value=((s=(e=(o=i.value.find(x=>{var v;return(v=x["x-scalar-environments"])==null?void 0:v[l]}))==null?void 0:o["x-scalar-environments"])==null?void 0:e[l])==null?void 0:s.color)??"",S.show()},ve=l=>{const o=m.value;typeof o=="string"&&(i.value.some(e=>{var s;return(s=e["x-scalar-environments"])==null?void 0:s[o]})&&i.value.forEach(e=>{var s;(s=e["x-scalar-environments"])!=null&&s[o]&&(e["x-scalar-environments"][o].color=l,I.edit(e.uid,"x-scalar-environments",e["x-scalar-environments"]))}),S.hide())};function de(l){i.value.forEach(e=>{I.removeEnvironment(l,e.uid)});const o=i.value.flatMap(e=>Object.keys(e["x-scalar-environments"]||{}));if(o.length>0){const e=o[o.length-1];if(!e)return;const s=i.value.find(x=>Object.keys(x["x-scalar-environments"]||{}).includes(e));c.value=e,_.push({name:"environment.collection",params:{collectionId:s==null?void 0:s.uid,environmentId:e}}),s&&!z[s.uid]&&M(s.uid)}else c.value="default",_.push({name:"environment",params:{environment:"default"}})}const me=()=>c.value==="default"?"Global Environment":c.value,fe=()=>{var l,o,e,s;return c.value==="default"?JSON.stringify((l=y.value)==null?void 0:l.environments,null,2):JSON.stringify((s=(e=(o=i.value.find(x=>{var v;return(v=x["x-scalar-environments"])==null?void 0:v[c.value??""]}))==null?void 0:o["x-scalar-environments"])==null?void 0:e[c.value??""])==null?void 0:s.variables,null,2)},pe=l=>z[l],Z=l=>{l!=null&&l.createNew&&n.name==="environment"&&L()};H(()=>[n.params[$.Collection],n.params[$.Environment]],([l,o])=>{l?c.value=o:c.value="default"}),_e(()=>{c.value=n.params[$.Environment]||"default",b.hotKeys.on(Z);const l=n.params[$.Collection];l&&!z[l]&&M(l)}),$e(()=>b.hotKeys.off(Z));const be=(l,o,e)=>{var s,x;const v=e?{name:"environment.collection",params:{[$.Workspace]:(s=y.value)==null?void 0:s.uid,[$.Collection]:e,[$.Environment]:o}}:{name:"environment.default",params:{[$.Workspace]:(x=y.value)==null?void 0:x.uid,[$.Environment]:o}};l.metaKey?window.open(_.resolve(v).href,"_blank"):_.push(v)};function xe(){V.value=void 0,O.value=void 0,R.value=void 0,t.hide()}function he(l){i.value.some(o=>{const e=Object.keys(o["x-scalar-environments"]||{}).includes(l);return X(e,o,O.value),e})||(l&&V.value!=="default"&&i.value.forEach(o=>{var e;if((e=o["x-scalar-environments"])!=null&&e[V.value??""]){const s=o["x-scalar-environments"][V.value??""];s&&(delete o["x-scalar-environments"][V.value??""],o["x-scalar-environments"][l]=s,I.edit(o.uid,"x-scalar-environments",o["x-scalar-environments"]))}}),l&&c.value===V.value&&(c.value=l),V.value=void 0,O.value=void 0,R.value=void 0,t.hide())}return(l,o)=>(d(),w(Fe,null,{default:h(()=>[f(Ne,{title:"Collections"},{content:h(()=>[C("div",Qe,[f(Re,null,{default:h(()=>[(d(),w(ee,{key:"default",class:"text-xs",isCopyable:!1,type:"environment",variable:{name:"Global Environment",uid:"default",icon:"Globe",isDefault:!0}})),(d(!0),D(F,null,A(r(i),e=>{var s;return d(),D("li",{key:e.uid,class:"gap-1/2 flex flex-col"},[C("button",{class:"hover:bg-b-2 group flex w-full items-center gap-1.5 break-words rounded p-1.5 text-left text-sm font-medium",type:"button",onClick:x=>r(M)(e.uid)},[C("span",qe,[f(r(De),{class:"text-sidebar-c-2 size-3.5 min-w-3.5 stroke-2 group-hover:hidden",src:e["x-scalar-icon"]||"interface-content-folder"},null,8,["src"]),C("div",{class:E({"rotate-90":r(z)[e.uid]})},[f(r(N),{class:"text-c-3 hover:text-c-1 hidden text-sm group-hover:block",icon:"ChevronRight",size:"md"})],2)]),T(" "+J(((s=e.info)==null?void 0:s.title)??""),1)],8,Ye),oe(C("div",{class:E({"before:bg-border before:z-1 relative mb-[.5px] before:pointer-events-none before:absolute before:left-3 before:top-0 before:h-[calc(100%_+_.5px)] before:w-[.5px] last:mb-0 last:before:h-full":Object.keys(e["x-scalar-environments"]||{}).length>0})},[(d(!0),D(F,null,A(e["x-scalar-environments"],(x,v)=>(d(),w(ee,{key:v,class:"text-xs [&>a]:pl-5",collectionId:e.uid,isCopyable:!1,isDeletable:!0,isRenameable:!0,type:"environment",variable:{name:v,uid:v,color:x.color??"#8E8E8E",isDefault:!1},warningMessage:"Are you sure you want to delete this environment?",onClick:ze(B=>be(B,v,e.uid),["prevent"]),onColorModal:B=>ue(v),onDelete:B=>de(v),onRename:B=>ce(v,e.uid)},null,8,["collectionId","variable","onClick","onColorModal","onDelete","onRename"]))),128)),Object.keys(e["x-scalar-environments"]||{}).length===0?(d(),w(r(G),{key:0,class:"text-c-1 hover:bg-b-2 flex h-8 w-full justify-start gap-1.5 py-0 pl-6 text-xs",variant:"ghost",onClick:x=>L(e.uid)},{default:h(()=>[f(r(N),{icon:"Add",size:"sm"}),o[2]||(o[2]=C("span",null,"Add Environment",-1))]),_:2},1032,["onClick"])):j("",!0)],2),[[Se,pe(e.uid)]])])}),128))]),_:1})])]),button:h(()=>[f(We,{click:L,hotkey:"N"},{title:h(()=>o[3]||(o[3]=[T(" Add Environment ")])),_:1})]),_:1}),f(Ue,{class:"flex-1"},{default:h(()=>[f(Oe,null,Ve({default:h(()=>[c.value&&r(y)?(d(),w(je,{key:0,class:"border-t py-2 pl-px pr-2 md:px-4",envVariables:r(k),environment:r(p),isCopyable:"",language:"json",lineNumbers:"",lint:"",modelValue:fe(),workspace:r(y),"onUpdate:modelValue":ie},null,8,["envVariables","environment","modelValue","workspace"])):j("",!0)]),_:2},[c.value?{name:"title",fn:h(()=>[C("span",null,J(me()),1)]),key:"0"}:void 0]),1024)]),_:1}),f(Ge,{selectedColor:Y.value,state:r(S),onCancel:o[0]||(o[0]=e=>r(S).hide()),onSubmit:ve},null,8,["selectedColor","state"]),f(He,{activeWorkspaceCollections:r(i),collectionId:O.value,state:r(a),onCancel:o[1]||(o[1]=e=>r(a).hide()),onSubmit:re},null,8,["activeWorkspaceCollections","collectionId","state"]),f(r(Q),{size:"xxs",state:r(t),title:`Edit ${V.value}`},{default:h(()=>[f(Me,{name:R.value??"",onClose:xe,onEdit:he},null,8,["name"])]),_:1},8,["state","title"])]),_:1}))}});export{nl as default};
